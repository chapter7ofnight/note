#### 一、数据库基本概念

##### 1、事务特性

a）ACID：Atomicity 原子性。事务内每个更新操作对应一条相反的 undo 日志，用于事务回滚。

b）Consistency 一致性

c）Isolation 隔离性

d）Durability 持久性。事务更新操作先写 redo 日志，防止错误导致的数据丢失。

##### 2、事务隔离级别

a）Serializable 可串行化：执行两段锁协议，先获取需要的锁不释放，再释放不需要的锁不获取。读写都加锁。

b）REPEATABLE READ 可重复读（MySQL 默认）：快照读。读不加锁，事务开始时创建 ReadView，读到一条记录时，遍历版本链表，读第一个对当前事务可见的版本。写操作需要加锁。如果事务 A 读取一个范围数据，而事务 B 在此范围内 insert 数据，事务 A 再次读数据数量变多，则导致幻读。

c）READ COMMITTED 提交读：语句开始时获取 ReadView，可见性判断针对语句。如果事务 A 读一个数据后，事务 B 进行 update，事务 A 无法再读到之前的数据，则导致不可重复读。

d）READ UNCOMMITTED 未提交读：直接读最新版本。如果事务 A 读到事务 B 未提交的数据，而事务 B 进行 rollback，则导致脏读。

概念：

1）事务 ID：全局唯一的递增的整数。

2）MVCC：B+树索引叶子节点保存最新的数据，通过隐藏的 roll_ptr 构成一个版本链表，保存每个事务对数据的更新及事务 ID，通过最新数据和 UNDO 信息，可以构造出每个版本的数据。

3）ReadView：保存活跃事务 ID，创建 ReadView 的事务 ID，活跃事务的最小 ID，活跃事务的最大 ID

4）可见性：根据事务 ID 判断给定的数据版本是否对一个 ReadView 可见。

##### 3、数据库范式

a）第一范式：每一列都不可再分

b）第二范式：所有非主属性（不存在于唯一索引中的列）完全依赖于任何一个候选码（唯一索引）

c）第三范式：所有非主属性都不传递依赖于候选码

d）BC 范式：所有主属性完全依赖不包含它的候选码

e）第四范式：属性间不能有非平凡且非函数的多值依赖



#### 二、MySQL 基本概念

##### 1、基础架构

a）核心服务：管理和工具组件；连接池；SQL 接口；解析器；优化器；缓存

b）存储引擎：InnoDB；MyISAM

c）物理文件：数据文件；日志文件

##### 2、SQL 执行过程

a）客户端请求（半双工）

b）查询缓存

c）解析器，预处理器，优化器对 SQL 语句进行分析、处理、优化得到查询执行计划

d）查询执行引擎根据查询执行计划去做实际的查询工作，期间可能会调存储引擎的接口

e）返回结果给客户端

##### 3、日志

a）--log-error：错误日志。

b）--log：查询日志，所有 MySQL 活动的日志。

c）--log-bin：数据更新的二进制日志，可以用于主备同步。

d）--log-slow-queries：慢查询日志，可以用于分析定位问题，提供优化参考。



#### 三、存储引擎

##### 1、InnoDB

​		不知道该选哪个存储引擎，也没有特殊需求的时候，就选这个引擎。

a）支持事务和外键，不保存总行数

b）使用聚簇索引（一级索引）：选择主键或唯一非空索引或内部隐式主键组成聚簇索引，叶子节点是完整的数据；其他索引为二级索引，叶子节点是聚簇索引的值。

c）支持行级锁：通过 MVCC 来支持并发操作，每条数据都有一个插入版本和删除版本，读数据时通过这个版本控制而不需要加锁。

d）可以通过间隙锁防止幻读。

e）崩溃后可以安全恢复。

##### 2、MyISAM

a）不支持事务和外键，保存总行数。

b）所有索引都是独立的，叶子节点保存数据的地址。索引和数据分开保存。

c）不支持行级锁。

d）支持全文本搜索。

e）崩溃后无法安全恢复。



#### 四、数据结构

##### 1、常用数据

a）string：char、varchar、text

b）数值：tinyint、smallint、mediumint、int、bigint；float、double；decimal

c）日期：date，time，datatime，timestamp

d）二进制：tinyblob、blob、mediumblob、longblob

##### 2、B+ 树

​		每个节点占 16k 空间。bigint id 占 8B，指针占 6B，每个节点可以存 1170 个数据和指针。3 层大概可以存 1170 * 1170 * 16 = 21902400 个数据。



#### 五、其他功能

##### 1、存储过程

​		一组实现特定功能的，保存在 MySQL 服务器上的 SQL 语句集。可以输出参数，输出结果。

##### 2、游标

​		在函数或存储过程内部，可以定义和使用游标。可以对数据集进行滚动操作。

##### 3、触发器

​		在更新数据的前后触发特定的时间以完成特定的操作。